<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | 前端文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.c16151cb.css" as="style"><link rel="preload" href="/assets/js/app.58f04004.js" as="script"><link rel="preload" href="/assets/js/2.72d74e75.js" as="script"><link rel="preload" href="/assets/js/101.3714e142.js" as="script"><link rel="prefetch" href="/assets/js/10.b84a7c64.js"><link rel="prefetch" href="/assets/js/100.008efd72.js"><link rel="prefetch" href="/assets/js/102.cfec82a4.js"><link rel="prefetch" href="/assets/js/103.74ca512c.js"><link rel="prefetch" href="/assets/js/104.3a336072.js"><link rel="prefetch" href="/assets/js/11.fe0e74db.js"><link rel="prefetch" href="/assets/js/12.de48ca6f.js"><link rel="prefetch" href="/assets/js/13.da6877eb.js"><link rel="prefetch" href="/assets/js/14.528ae643.js"><link rel="prefetch" href="/assets/js/15.c0d4cae2.js"><link rel="prefetch" href="/assets/js/16.b71d2e49.js"><link rel="prefetch" href="/assets/js/17.67be6bac.js"><link rel="prefetch" href="/assets/js/18.13984d56.js"><link rel="prefetch" href="/assets/js/19.ebca0ab9.js"><link rel="prefetch" href="/assets/js/20.b6a5314d.js"><link rel="prefetch" href="/assets/js/21.bb10d8b2.js"><link rel="prefetch" href="/assets/js/22.f10df079.js"><link rel="prefetch" href="/assets/js/23.a822680d.js"><link rel="prefetch" href="/assets/js/24.360e6d19.js"><link rel="prefetch" href="/assets/js/25.1a4e256e.js"><link rel="prefetch" href="/assets/js/26.b28381cc.js"><link rel="prefetch" href="/assets/js/27.f7cce0ef.js"><link rel="prefetch" href="/assets/js/28.823d3358.js"><link rel="prefetch" href="/assets/js/29.54e6a189.js"><link rel="prefetch" href="/assets/js/3.84922cf3.js"><link rel="prefetch" href="/assets/js/30.01d92de2.js"><link rel="prefetch" href="/assets/js/31.2ceeee02.js"><link rel="prefetch" href="/assets/js/32.1193fd5d.js"><link rel="prefetch" href="/assets/js/33.13214ed0.js"><link rel="prefetch" href="/assets/js/34.0bc17c61.js"><link rel="prefetch" href="/assets/js/35.5f368a36.js"><link rel="prefetch" href="/assets/js/36.045dbaf9.js"><link rel="prefetch" href="/assets/js/37.15362138.js"><link rel="prefetch" href="/assets/js/38.69d1ded3.js"><link rel="prefetch" href="/assets/js/39.e9284172.js"><link rel="prefetch" href="/assets/js/4.cde39425.js"><link rel="prefetch" href="/assets/js/40.651682e8.js"><link rel="prefetch" href="/assets/js/41.aebdf2fa.js"><link rel="prefetch" href="/assets/js/42.bc98c52a.js"><link rel="prefetch" href="/assets/js/43.e2f77f84.js"><link rel="prefetch" href="/assets/js/44.ce5973cd.js"><link rel="prefetch" href="/assets/js/45.6d4d1019.js"><link rel="prefetch" href="/assets/js/46.1ecb0155.js"><link rel="prefetch" href="/assets/js/47.a91df53e.js"><link rel="prefetch" href="/assets/js/48.a8892445.js"><link rel="prefetch" href="/assets/js/49.fd13a267.js"><link rel="prefetch" href="/assets/js/5.3988f2a7.js"><link rel="prefetch" href="/assets/js/50.8f4c953a.js"><link rel="prefetch" href="/assets/js/51.c63c7d06.js"><link rel="prefetch" href="/assets/js/52.8cacdf11.js"><link rel="prefetch" href="/assets/js/53.d0a4aedb.js"><link rel="prefetch" href="/assets/js/54.89ecf6b4.js"><link rel="prefetch" href="/assets/js/55.75f9af84.js"><link rel="prefetch" href="/assets/js/56.7811d98a.js"><link rel="prefetch" href="/assets/js/57.31eceea4.js"><link rel="prefetch" href="/assets/js/58.dc4a7ed8.js"><link rel="prefetch" href="/assets/js/59.e8e373e7.js"><link rel="prefetch" href="/assets/js/6.3028bb71.js"><link rel="prefetch" href="/assets/js/60.205b17bd.js"><link rel="prefetch" href="/assets/js/61.f68e6746.js"><link rel="prefetch" href="/assets/js/62.32df277b.js"><link rel="prefetch" href="/assets/js/63.d5936a75.js"><link rel="prefetch" href="/assets/js/64.0cd9401d.js"><link rel="prefetch" href="/assets/js/65.cda5980a.js"><link rel="prefetch" href="/assets/js/66.fd45dcc5.js"><link rel="prefetch" href="/assets/js/67.07a01b3f.js"><link rel="prefetch" href="/assets/js/68.d39a7bef.js"><link rel="prefetch" href="/assets/js/69.53c7de37.js"><link rel="prefetch" href="/assets/js/7.57913225.js"><link rel="prefetch" href="/assets/js/70.7e276bbb.js"><link rel="prefetch" href="/assets/js/71.d72f9f89.js"><link rel="prefetch" href="/assets/js/72.8c50b16a.js"><link rel="prefetch" href="/assets/js/73.50b6233a.js"><link rel="prefetch" href="/assets/js/74.478dab79.js"><link rel="prefetch" href="/assets/js/75.2aeddba9.js"><link rel="prefetch" href="/assets/js/76.3e36b75d.js"><link rel="prefetch" href="/assets/js/77.851e36c1.js"><link rel="prefetch" href="/assets/js/78.0ffcde61.js"><link rel="prefetch" href="/assets/js/79.2c79c02e.js"><link rel="prefetch" href="/assets/js/8.1faf059c.js"><link rel="prefetch" href="/assets/js/80.197d0d92.js"><link rel="prefetch" href="/assets/js/81.e7f9cb50.js"><link rel="prefetch" href="/assets/js/82.51cd9ae2.js"><link rel="prefetch" href="/assets/js/83.f4725e16.js"><link rel="prefetch" href="/assets/js/84.15cacdf2.js"><link rel="prefetch" href="/assets/js/85.ae126ee1.js"><link rel="prefetch" href="/assets/js/86.6d1c4bac.js"><link rel="prefetch" href="/assets/js/87.236d21a3.js"><link rel="prefetch" href="/assets/js/88.cd862051.js"><link rel="prefetch" href="/assets/js/89.09b1a8d7.js"><link rel="prefetch" href="/assets/js/9.b58cbdb9.js"><link rel="prefetch" href="/assets/js/90.3c50d1f8.js"><link rel="prefetch" href="/assets/js/91.d3d51315.js"><link rel="prefetch" href="/assets/js/92.5eb05255.js"><link rel="prefetch" href="/assets/js/93.15b79eec.js"><link rel="prefetch" href="/assets/js/94.485c4437.js"><link rel="prefetch" href="/assets/js/95.2b21d45e.js"><link rel="prefetch" href="/assets/js/96.3be6aa08.js"><link rel="prefetch" href="/assets/js/97.b1bb574e.js"><link rel="prefetch" href="/assets/js/98.5b40f5e2.js"><link rel="prefetch" href="/assets/js/99.4d1043a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c16151cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="front end" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="front end" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link">
  js
</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  linux
</a></div><div class="nav-item"><a href="https://github.com/305810827" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="front end" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="front end" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">
  html
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link">
  js
</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  linux
</a></div><div class="nav-item"><a href="https://github.com/305810827" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>每日一题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/question/违规取证项目.html" class="sidebar-link">违规取证项目</a></li><li><a href="/question/添加dns解析缓存，加速页面访问.html" class="sidebar-link">添加dns解析缓存，加速页面访问</a></li><li><a href="/question/提取网站正文内容.html" class="sidebar-link">提取网站正文内容</a></li><li><a href="/question/使用puppeteer爬虫的总结.html" class="active sidebar-link">使用puppeteer爬虫的总结</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/question/wanted-order.html" class="sidebar-link">wanted-order</a></li><li><a href="/question/submodule.html" class="sidebar-link">submodule</a></li><li><a href="/question/resolve.html" class="sidebar-link">resolve</a></li><li><a href="/question/plugins.html" class="sidebar-link">plugins</a></li><li><a href="/question/load、domcontentloaded.html" class="sidebar-link">load、domcontentloaded</a></li><li><a href="/question/linux install puppeteer error.html" class="sidebar-link">linux install puppeteer error</a></li><li><a href="/question/git设定不合并的文件.html" class="sidebar-link">git设定不合并的文件</a></li><li><a href="/question/entry和output.html" class="sidebar-link">entry和output</a></li><li><a href="/question/context.html" class="sidebar-link">context</a></li><li><a href="/question/Module.html" class="sidebar-link">Module</a></li><li><a href="/question/IP地址.html" class="sidebar-link">IP地址</a></li><li><a href="/question/Chrome扩展通信1.html" class="sidebar-link">Chrome扩展通信1</a></li><li><a href="/question/Chrome扩展通信.html" class="sidebar-link">Chrome扩展通信</a></li><li><a href="/question/--unsafe-perm.html" class="sidebar-link">--unsafe-perm</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h3> <p>​		Puppeteer 是一个 Node 库，它提供了一个高级 API 来通过<a href="https://chromedevtools.github.io/devtools-protocol/" target="_blank" rel="noopener noreferrer">DevTools 协议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>控制 <a href="https://developers.google.com/web/updates/2017/04/headless-chrome" target="_blank" rel="noopener noreferrer">无头<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>Chrome 或 Chromium，无头Chrome就是可以在不打开浏览器的情况下，在v8引擎中处理dom的操作，因为没有UI，所以性能比真实浏览器更好。它还可以配置为使用完整（非无头）Chrome 或 Chromium。</p> <h3 id="主要作用"><a href="#主要作用" class="header-anchor">#</a> 主要作用</h3> <p>​		1、爬取页面中动态加载的的内容</p> <p>​		2、自动化测试，控制鼠标和键盘的输入，还有各种高级 API 可操作浏览器。</p> <h3 id="使用总结"><a href="#使用总结" class="header-anchor">#</a> 使用总结</h3> <h5 id="_1、puppeteer浏览器上下文"><a href="#_1、puppeteer浏览器上下文" class="header-anchor">#</a> 1、puppeteer浏览器上下文</h5> <p>​		puppeteer可以通过配置启动参数（下面常用参数）得到浏览器上下文对象browser，还可以通过browser对象的createIncognitoBrowserContext方法得到无痕的浏览器上下文对象context。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">ignoreHTTPSErrors</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                      <span class="token comment">// 是否忽略 HTTPS 错误</span>
  <span class="token literal-property property">userDataDir</span><span class="token operator">:</span> <span class="token string">&quot;./user_data&quot;</span>										<span class="token comment">// 用户数据目录,例如历史记录、书签和 cookie</span>
  <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                               <span class="token comment">// ”无头(无UI)”的模式运行chrome，提高性能</span>
  <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token punctuation">[</span>                                        <span class="token comment">// 要传递给浏览器实例的其他参数</span>
    <span class="token string">'--no-sandbox'</span><span class="token punctuation">,</span>															<span class="token comment">// 禁用沙箱，为了让root用户也能执行</span>
    <span class="token string">'--proxy-server=http://127.0.0.1:20127'</span><span class="token punctuation">,</span>    <span class="token comment">// 设置HTTP和HTTPS请求的代理服务器</span>
    <span class="token string">'--disable-web-security'</span><span class="token punctuation">,</span>                   <span class="token comment">// 不执行同源政策</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个新的隐身浏览器上下文，无痕下无用户数据</span>
<span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">createIncognitoBrowserContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2、page-goto-url-options-页面加载的优化"><a href="#_2、page-goto-url-options-页面加载的优化" class="header-anchor">#</a> 2、page.goto(url[, options])，页面加载的优化</h5> <p>​		在爬取各种网址的数据过程中，总会出现网址加载慢或者加载不出来的情况（不包含ip禁用），所以我们需要减少页面不必要文件的加载，同时要给页面加载时限。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 激活请求拦截</span>
<span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setRequestInterception</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 请求会被拦截停止，除非使用request的bort、continue或者response方法</span>
page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token parameter">req</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 将以下类型的请求都拦截掉</span>
	<span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'other'</span><span class="token punctuation">,</span> <span class="token string">'stylesheet'</span><span class="token punctuation">,</span> <span class="token string">'script'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">resourceType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	flag <span class="token operator">?</span> req<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.google.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">waitUntil</span><span class="token operator">:</span><span class="token punctuation">[</span>             <span class="token comment">// 设置网页导航完成的条件，字符串或数组，为数组时需要满足所有条件才算导航完成</span>
    <span class="token string">'load'</span><span class="token punctuation">,</span>               <span class="token comment">// load事件触发后</span>
    <span class="token string">'domcontentloaded'</span><span class="token punctuation">,</span>   <span class="token comment">// domcontentloaded事件触发后</span>
    <span class="token string">'networkidle0'</span><span class="token punctuation">,</span>       <span class="token comment">// 500ms内无网络请求</span>
    <span class="token string">'networkidle2'</span>				<span class="token comment">// 500ms内没有超过2个网络请求</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">30000</span>          <span class="token comment">// 网页加载超过30s就加载失败 </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token comment">//结束后需要关闭网页和浏览器</span>
page<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="_3、配置代理"><a href="#_3、配置代理" class="header-anchor">#</a> 3、配置代理</h5> <p>​		puppeteer提供在launch时可以配置代理服务器，但是这样有几个缺点:</p> <p>​		1、整个浏览器上下文创建的page使用的同一个代理服务器。
​		2、如果要切换代理，则需要关闭整个browser，再修改--proxy-server重新实例化一个browser。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">arg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'--proxy-server=http://127.0.0.1:20127'</span><span class="token punctuation">,</span>    <span class="token comment">// 设置HTTP和HTTPS请求的代理服务器</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​		针对上面问题，可以使用npm包puppeteer-page-proxy，主要原理就是通过激活拦截请求，给每个拦截的request配置上代理服务器。</p> <p>​		用法1：可以只给page设置proxy，不需要重启browser。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> useProxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer-page-proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">useProxy</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> <span class="token string">'http://127.0.0.1:80'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 设置http://127.0.0.1:80代理服务器</span>
<span class="token keyword">await</span> <span class="token function">useProxy</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 取消代理</span>
</code></pre></div><p>​		用法2：给每个request设置proxy。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setRequestInterception</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">useProxy</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'https://127.0.0.1:443'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_4、useragent"><a href="#_4、useragent" class="header-anchor">#</a> 4、userAgent</h5> <p>​		每个page可以通过setUserAgent方法配置不同的userAgent。使用user-agents包，可以随机产生一个指定系统或者浏览器的UserAgent。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> UserAgent <span class="token keyword">from</span> <span class="token string">'user-agents'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> opt         <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^((?!linux).)*$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">deviceCategory</span><span class="token operator">:</span> <span class="token string">'desktop'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">platform</span>      <span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> <span class="token string">'Win32'</span> <span class="token operator">:</span> <span class="token string">'MacIntel'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 不配置opt则随机输出</span>
<span class="token keyword">const</span> userAgent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAgent</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

page<span class="token punctuation">.</span><span class="token function">setUserAgent</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span>
</code></pre></div><h5 id="_5、在页面植入js"><a href="#_5、在页面植入js" class="header-anchor">#</a> 5、在页面植入js</h5> <p>​		page.evaluate(pageFunction, ...args)，pageFunction是在页面实例上下文中执行的方法，所以不能调用在当前js写的函数，需要在页面中植入该函数才能调用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getNum</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">addScriptTag</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> getNum <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">getNum</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// 页面中的控制台会输出2</span>
</code></pre></div><p>6、执行脚本僵死；</p> <p>7、监听browser disconnect (调查一下)</p> <p>8、禁止 webrtc</p> <p>9、禁止canvas</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/question/提取网站正文内容.html" class="prev">
        提取网站正文内容
      </a></span> <span class="next"><a href="/question/wanted-order.html">
        wanted-order
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.58f04004.js" defer></script><script src="/assets/js/2.72d74e75.js" defer></script><script src="/assets/js/101.3714e142.js" defer></script>
  </body>
</html>
